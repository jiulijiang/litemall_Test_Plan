# 轻商城系统性能测试报告

## 1. 测试概述

### 1.1 测试目的

本次性能测试旨在评估轻商城系统在预期用户负载下的性能表现，验证系统是否满足性能需求，识别系统性能瓶颈，为系统优化提供依据。

### 1.2 测试范围

本次性能测试主要针对以下核心接口：

- 获取首页数据：`/wx/home/index`
- 用户登录接口：`/wx/auth/login`
- 商品搜索接口：`/wx/goods/list`
- 加入购物车接口：`/wx/cart/add`

### 1.3 测试工具

- Apache JMeter 5.6.3
- 监控工具：系统资源监控工具

### 1.4 测试时间

- 测试开始时间：
- 测试结束时间：

### 1.5 参考文档

- 《测试计划.md》
- 《轻商城项目-API文档.md》
- 《需求文档.md》

## 2. 测试环境

### 2.1 硬件环境

| 环境类型       | 操作系统        | CPU      | 内存 | 网络     |
| -------------- | --------------- | -------- | ---- | -------- |
| 测试机         | Windows 11 64位 | Intel i7 | 32GB | 100Mbps  |
| 被测系统服务器 | CentOS 7.9 64位 | 虚拟4核  | 8GB  | 1000Mbps |

### 2.2 软件环境

- 被测系统版本：
- 数据库：MySQL 5.7
- Web服务器：Tomcat 8.5
- JDK版本：JDK 1.8

## 3. 测试场景设计

### 3.1 测试场景描述

| 场景编号 | 场景名称     | 并发用户数    | 持续时间 | 测试目标                                       |
| -------- | ------------ | ------------- | -------- | ---------------------------------------------- |
| SC01     | 获取首页场景 | 1, 10, 20, 30 | 5分钟    | 验证首页接口在不同并发下的响应时间和吞吐量     |
| SC02     | 商品搜索场景 | 1, 5, 10, 15  | 5分钟    | 验证搜索接口在不同并发下的响应时间和吞吐量     |
| SC03     | 用户登录场景 | 1, 5, 10, 20  | 5分钟    | 验证用户登录接口在不同并发下的响应时间和吞吐量 |
| SC04     | 混合业务场景 | 1, 5, 10, 15  | 10分钟   | 验证系统在完整业务流程下的整体性能表现         |
| SC05     | 峰值场景     | 30, 50        | 1分钟    | 验证系统在短时间内高并发下的极限承载能力       |
| SC06     | 稳定性场景   | 5             | 24小时   | 验证系统在长时间运行下的稳定性和资源泄漏情况   |

### 3.2 混合业务场景流程

混合业务场景包含完整的用户购物流程，具体步骤如下：

1. 获取首页数据（`/wx/home/index`）
2. 商品搜索（`/wx/goods/list`），搜索关键词"母亲节"，并提取商品ID
3. 用户登录（`/wx/auth/login`），使用参数化的账号密码，获取登录token
4. 加入购物车（`/wx/cart/add`），使用提取的商品ID和登录token

### 3.3 峰值场景说明

峰值场景模拟系统在短时间内承受高并发请求的情况，通常用于验证系统的极限承载能力和故障恢复能力：

- 快速加压：在1-2秒内将并发用户数提升至目标值
- 持续时间短：通常维持1-3分钟的峰值负载
- 关注指标：系统最大TPS、峰值响应时间、错误率变化、资源峰值使用情况
- 故障恢复：峰值结束后观察系统是否能快速恢复正常
- 考虑系统实际性能，峰值测试采用较低的并发值进行验证

### 3.4 稳定性场景说明

稳定性场景模拟系统在较长时间内持续运行的情况，用于验证系统的长期稳定性、可靠性及资源管理能力：

- 负载适中：考虑系统实际性能，采用低并发用户数（5并发用户）
- 持续时间长：测试时长通常为8-24小时
- 关注指标：响应时间稳定性、错误率累积、资源使用趋势（CPU、内存、磁盘I/O）
- 重点监控：内存泄漏、连接池耗尽、日志增长、临时文件堆积等问题

## 4. 性能指标定义

### 4.1 关键性能指标

| 指标名称           | 指标说明                     | 预期标准                 |
| ------------------ | ---------------------------- | ------------------------ |
| 单用户基准响应时间 | 用户发起请求到收到响应的时间 | 平均响应时间 < 500ms     |
| 响应时间           | 用户发起请求到收到响应的时间 | 90%请求响应时间 < 2000ms |
| 吞吐量(TPS)        | 系统每秒处理的事务数         | 满足业务高峰期需求       |
| 并发用户数         | 同时向系统发送请求的用户数   | 支持预期最大并发用户数   |
| 错误率             | 请求失败的比例               | < 0.1%                   |
| CPU使用率          | 服务器CPU使用率              | < 80%                    |
| 内存使用率         | 服务器内存使用率             | < 80%                    |

### 4.2 性能测试通过标准

- 系统在预期负载下稳定运行
- 关键接口响应时间满足要求
- 系统资源使用率在合理范围内
- 无严重错误发生

## 5. 测试执行情况

### 5.1 测试执行过程

- 测试脚本软件准备：JMeter 5.6.3，配置了HTTP请求默认值指向目标服务器 `www.litemall360.com:8080`
- 测试数据准备：100个账号做测试数据，用户名从user0001开始到user0100，手机号从13900000000开始，密码与用户名相同，存储在 `D:/Gtihub/litemall_Test_Plan/litemall_Test_Plan/Jmeter/userlogin.csv`
- 测试执行流程：
  1. **单用户基准测试**：先执行单用户测试，验证接口功能正确性并建立性能基线
  2. **逐步加压测试**：在单用户测试通过基础上，依次执行低并发用户的递增测试
  3. **峰值测试**：在稳定负载测试基础上执行低并发峰值测试（30/50用户）
  4. **稳定性测试**：使用低负载（5并发用户）进行长时间稳定性测试
- 技术实现：使用CSV数据文件配置进行参数化，每个请求都添加了响应码和响应内容断言

### 5.2 测试监控指标

- 系统资源使用情况（CPU、内存、磁盘I/O）
- 网络带宽使用情况
- 数据库连接数和性能

## 6. 测试结果分析

### 6.1 性能测试结果汇总

#### 6.1.1 获取首页场景性能结果

| 并发用户数 | 平均响应时间(ms) | 90%响应时间(ms) | 95%响应时间(ms) | 99%响应时间(ms) | 吞吐量(TPS) | 错误率 | CPU使用率 | 内存使用率 |
| ---------- | ---------------- | --------------- | --------------- | --------------- | ----------- | ------ | --------- | ---------- |
| 1          | 49               | 61              | 64              | 74              | 20.2        | 0      | 28        | 33.5       |
| 10         | 215              | 287             | 310             | 354             | 46          | 0      | 66.2      | 37.4       |
| 15         | 341              | 430             | 461             | 520             | 43.4        | 0      | 64.7      | 37.4       |
| 20         | 452              | 556             | 595             | 680             | 43.5        | 0      | 64        | 37.4       |

**分析**：获取首页场景在1用户时响应时间优秀（49ms），随着并发增加响应时间线性增长，但在10并发时TPS达到峰值46，之后增加并发用户数TPS开始下降，说明系统在该场景下存在性能瓶颈。

#### 6.1.2 商品搜索接口性能结果

| 并发用户数 | 平均响应时间(ms) | 90%响应时间(ms) | 95%响应时间(ms) | 99%响应时间(ms) | 吞吐量(TPS) | 错误率 | CPU使用率 | 内存使用率 |
| ---------- | ---------------- | --------------- | --------------- | --------------- | ----------- | ------ | --------- | ---------- |
| 1          | 18               | 24              | 26              | 34              | 54.9        | 0      | 18.4      | 36.5       |
| 10         | 41               | 58              | 64              | 77              | 237.9       | 0      | 84        | 36.9       |
| 20         | 76               | 111             | 124             | 154             | 257.4       | 0      | 90.2      | 37.4       |
| 30         | 126              | 157             | 174             | 221             | 231.3       | 0      | 81.9      | 37.1       |

**分析**：商品搜索接口性能表现最佳，单用户响应时间仅18ms，20并发时TPS达到峰值257.4，即使在30并发下仍保持较高性能。值得注意的是，20并发时CPU使用率已达90.2%，接近饱和状态。

#### 6.1.3 用户登录场景性能结果

| 并发用户数 | 平均响应时间(ms) | 90%响应时间(ms) | 95%响应时间(ms) | 99%响应时间(ms) | 吞吐量(TPS) | 错误率 | CPU使用率 | 内存使用率 |
| ---------- | ---------------- | --------------- | --------------- | --------------- | ----------- | ------ | --------- | ---------- |
| 1          | 177              | 189             | 195             | 214             | 5.6         | 0      | 23        | 37.8       |
| 5          | 189              | 232             | 247             | 287             | 26.3        | 0      | 98.4      | 37.8       |
| 10         | 384              | 476             | 496             | 529             | 25.8        | 0      | 98.9      | 37.2       |
| 15         | 573              | 661             | 684             | 729             | 25.8        | 0      | 98.9      | 37.2       |

**分析**：用户登录场景是性能最差的单一场景，5并发时CPU使用率已达98.4%，几乎完全饱和。增加并发用户数后TPS几乎不变，但响应时间急剧增加，表明系统在登录处理上存在严重瓶颈。

### 6.2 混合业务场景测试结果

| 并发用户数 | 平均响应时间(ms) | 90%响应时间(ms) | 95%响应时间(ms) | 99%响应时间(ms) | 吞吐量(TPS) | 错误率 | CPU使用率 | 内存使用率 |
| ---------- | ---------------- | --------------- | --------------- | --------------- | ----------- | ------ | --------- | ---------- |
| 1          | 43               | 139             | 160             | 174             | 90.7        | 0      | 87.2      | 37.8       |
| 3          | 161              | 354             | 418             | 538             | 74.1        | 0      | 91.8      | 38         |
| 5          | 311              | 658             | 762             | 1039            | 63.9        | 0      | 94.1      | 37.8       |
| 10         | 778              | 1692            | 1801            | 1979            | 51          | 0      | 93.9      | 38         |

**分析**：混合业务场景在单用户下表现良好，但CPU使用率已经很高（87.2%）。随着并发增加，响应时间显著增长，10并发时99%响应时间接近2000ms，达到了性能标准的临界值。

### 6.3 峰值场景测试结果

| 峰值并发数 | 最大TPS | 峰值平均响应时间(ms) | 峰值95%响应时间(ms) | 峰值99%响应时间(ms) | 最高错误率 | 峰值CPU使用率 | 峰值内存使用率 | 系统稳定性 | 恢复时间(s) |
| ---------- | ------- | -------------------- | ------------------- | ------------------- | ---------- | ------------- | -------------- | ---------- | ----------- |
| 50         | 433     | 138                  | 201                 | 273                 | 0          | 91.2          | 38.2           | 良好       | 12          |
| 100        | 326     | 377                  | 499                 | 508                 | 0          | 83.4          | 38.2           | 良好       | 42          |

**分析**：峰值场景下系统表现出一定的抗压能力，即使在100并发用户冲击下，错误率仍为0。但50并发时TPS为433，而100并发时TPS降至326，表明系统已达到处理极限，开始出现性能下降。系统恢复能力良好，峰值结束后能在12-42秒内恢复正常。

### 6.4 稳定性场景测试结果

| 测试时长(小时) | 并发用户数 | 平均TPS | 平均响应时间(ms) | 最大响应时间(ms) | 累积错误率 | 内存使用趋势 | CPU使用趋势           | 磁盘使用趋势 | 系统稳定性评估 | 主要问题发现                            |
| -------------- | ---------- | ------- | ---------------- | ---------------- | ---------- | ------------ | --------------------- | ------------ | -------------- | --------------------------------------- |
| 8              | 5          | 0       | Null             | Null             | 100%       | 保持38.5     | 3h12min时由85骤降至24 | 保持5        | 不通过         | 运行3h12min时系统崩溃，无法处理任何请求 |

**分析**：稳定性测试结果显示系统存在严重的稳定性问题，仅在3小时12分钟后就发生完全崩溃。CPU使用率的骤降（从85%降至24%）表明系统可能出现了服务停止或崩溃的情况，导致无法处理任何请求。

### 6.5 性能瓶颈分析

- **发现的性能问题**：
  1. CPU资源严重不足：多个场景下CPU使用率接近或达到100%
  2. 用户登录接口性能极差：低并发下CPU已饱和
  3. 系统稳定性严重不足：长时间运行后发生崩溃
  4. 吞吐量增长受限：增加并发用户数后TPS不增反降
  5. 响应时间随并发增长过快：尤其是混合业务场景

- **问题原因分析**：
  1. CPU瓶颈：服务器配置（虚拟4核）无法满足系统运行需求
  2. 代码效率问题：登录接口可能存在复杂计算或不合理的实现逻辑
  3. 资源泄漏：长时间运行后系统崩溃，可能存在内存泄漏或连接池耗尽
  4. 缺乏优化：SQL查询、缓存机制等方面可能存在优化空间
  5. 并发处理能力不足：系统在多线程并发下性能急剧下降

- **优化建议**：
  1. **硬件资源扩展**：增加服务器CPU核心数，提高服务器配置
  2. **代码优化**：
     - 重点优化登录接口，检查是否存在性能瓶颈代码
     - 优化数据库查询，添加适当索引
     - 实现缓存机制，减少重复计算和数据库访问
  3. **资源管理优化**：
     - 检查并修复可能的内存泄漏问题
     - 合理配置连接池参数
     - 实现请求队列和限流机制
  4. **架构调整**：
     - 考虑引入缓存层（如Redis）
     - 实现读写分离
     - 为不同接口配置不同的资源池
  5. **监控与预警**：
     - 部署实时监控系统，及时发现性能异常
     - 实现自动扩缩容机制

## 7. 测试结论

### 7.1 性能评估结论

- **系统是否满足性能需求**：基于测试结果，系统**未完全满足**预期性能需求，尤其是在稳定性和并发处理能力方面存在较大差距。
- **系统在各场景下的表现**：
  - 单用户场景：所有接口在单用户下性能表现良好，响应时间均在可接受范围内
  - 低并发场景（<10用户）：基本能满足性能需求，但用户登录场景已出现CPU饱和现象
  - 中等并发场景（10-30用户）：大部分接口性能开始下降，TPS增长受限
  - 高并发场景（>30用户）：系统性能急剧下降，主要受限于CPU资源
  - 峰值场景：系统展现出一定的峰值处理能力，但无法维持高TPS
  - 稳定性场景：系统严重不达标，运行3小时左右即崩溃

### 7.2 存在的问题

- **性能瓶颈**：
  - CPU资源不足：虚拟4核CPU在多数场景下接近饱和
  - 用户登录接口处理效率低：可能存在算法或实现逻辑问题
  - 并发处理机制不完善：多用户并发时系统性能下降明显

- **资源使用问题**：
  - CPU使用率过高：多个场景下CPU使用率超过90%
  - 存在资源泄漏：长时间运行导致系统崩溃
  - 内存使用率稳定但无法支撑长时间运行

- **其他问题**：
  - 系统稳定性极差：无法通过基本的8小时稳定性测试
  - 扩展性不足：增加并发用户数后系统性能不升反降
  - 缺乏有效的过载保护机制

### 7.3 优化建议

- **系统优化建议**：
  - 实施分层缓存策略：对热点数据（如首页数据、热门商品）使用多级缓存
  - 引入消息队列：对非实时性要求高的操作使用异步处理
  - 实现限流熔断机制：防止系统因过载而完全崩溃
  - 优化数据库连接池配置：合理设置连接数和超时参数

- **代码优化建议**：
  - 对登录接口进行重点代码审查和性能分析
  - 优化算法复杂度，减少不必要的计算操作
  - 使用更高效的数据结构和集合框架
  - 检查并修复内存泄漏问题
  - 优化循环和条件判断逻辑

- **数据库优化建议**：
  - 对频繁查询的字段添加适当索引
  - 优化SQL语句，减少全表扫描和复杂连接查询
  - 考虑实现读写分离架构
  - 对大表进行分区或分表处理
  - 使用连接池管理数据库连接

- **部署优化建议**：
  - 提高服务器硬件配置，特别是增加CPU核心数
  - 考虑水平扩展，部署多台服务器实现负载均衡
  - 优化JVM参数配置，提高内存使用效率
  - 实施CDN加速静态资源访问
  - 定期清理日志和临时文件，防止磁盘空间耗尽

## 8. 附录

### 8.1 测试脚本说明

- JMeter测试脚本清单：`Litemall性能测试方案.jmx`
- 测试数据文件：`userlogin.csv`，包含100个测试账号
- 脚本特点：使用参数化技术、JSON提取器、响应断言等功能

### 8.2 测试结果图表

- 响应时间趋势图：
- 吞吐量趋势图：
- 错误率趋势图：
- 系统资源使用图：
- 峰值场景性能曲线图：展示TPS、响应时间、错误率随时间变化的关系图
- 稳定性场景资源使用趋势图：展示CPU、内存、磁盘使用随时间的变化趋势
- 稳定性场景响应时间分布热图：展示长时间运行中响应时间的分布情况

### 8.3 术语表

| 术语       | 说明                                 |
| ---------- | ------------------------------------ |
| TPS        | 每秒事务数                           |
| RT         | 响应时间                             |
| 并发用户数 | 同时向系统发送请求的用户数           |
| 吞吐量     | 系统在单位时间内处理的请求数量       |
| 基准测试   | 单用户下的性能测试，用于建立性能基线 |
| 性能基线   | 系统在正常情况下的性能指标参考值     |
| 性能拐点   | 系统性能开始急剧下降的临界点         |
